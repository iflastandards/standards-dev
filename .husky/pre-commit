#!/usr/bin/env sh
# NX-optimized pre-commit hook for IFLA Standards project
# Runs essential checks on affected projects only

echo "ğŸ” Running NX-optimized pre-commit checks..."

# Run affected checks in parallel for maximum efficiency
echo "âš¡ Running affected typecheck, lint, and test in parallel..."
{
  nx affected --target=typecheck --parallel=3 &
  nx affected --target=lint --parallel=3 &
  nx affected --target=test --parallel=3 &
  wait
} || {
  echo "âŒ Pre-commit checks failed. Please fix and try again."
  exit 1
}

# Quick configuration validation for affected sites only
echo "âš™ï¸  Validating affected site configurations..."
node scripts/test-site-builds-affected.js --env local --skip-build
if [ $? -ne 0 ]; then
  echo "âŒ Site configuration validation failed."
  exit 1
fi

echo "âœ… All NX-optimized pre-commit checks passed!"