"use strict";(self.webpackChunkstandards_dev=self.webpackChunkstandards_dev||[]).push([[7434],{31240:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"development/IMPLEMENTATION-NOTES","title":"Implementation Notes","description":"This document captures key implementation details, design decisions, and solutions developed during the ISBDM project. Each section represents a specific feature or pattern that has been implemented successfully.","source":"@site/docs/development/IMPLEMENTATION-NOTES.md","sourceDirName":"development","slug":"/development/IMPLEMENTATION-NOTES","permalink":"/standards-dev/ISBDM/docs/development/IMPLEMENTATION-NOTES","draft":false,"unlisted":false,"editUrl":"https://github.com/iflastandards/ISBDM/tree/main/docs/development/IMPLEMENTATION-NOTES.md","tags":[],"version":"current","lastUpdatedBy":"Jon Phipps","lastUpdatedAt":1750096876000,"frontMatter":{}}');var t=s(23420),r=s(65404);const l={},o="Implementation Notes",a={},d=[{value:"Project Overview",id:"project-overview",level:2},{value:"Project Context for ISBDM",id:"project-context-for-isbdm",level:3},{value:"Workflow and Lifecycle",id:"workflow-and-lifecycle",level:3},{value:"Architecture",id:"architecture",level:3},{value:"Versioning Strategy",id:"versioning-strategy",level:3},{value:"Upcoming Development",id:"upcoming-development",level:3},{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Global Component Defaults",id:"global-component-defaults",level:2},{value:"Overview",id:"overview",level:3},{value:"Implementation Details",id:"implementation-details",level:3},{value:"Testing Approach",id:"testing-approach",level:3},{value:"Usage Examples",id:"usage-examples",level:3},{value:"Documentation",id:"documentation",level:3},{value:"Image Size Module Fix",id:"image-size-module-fix",level:2},{value:"Problem",id:"problem",level:3},{value:"Solution",id:"solution",level:3},{value:"Root Cause Analysis",id:"root-cause-analysis",level:3},{value:"Alternative Approaches (Not Used)",id:"alternative-approaches-not-used",level:3},{value:"Documentation",id:"documentation-1",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"implementation-notes",children:"Implementation Notes"})}),"\n",(0,t.jsx)(n.p,{children:"This document captures key implementation details, design decisions, and solutions developed during the ISBDM project. Each section represents a specific feature or pattern that has been implemented successfully."}),"\n",(0,t.jsx)(n.h2,{id:"project-overview",children:"Project Overview"}),"\n",(0,t.jsx)(n.p,{children:"The ISBDM (International Standard Bibliographic Description for Manifestation) project is not just a documentation site but a complete workflow and toolchain for creating, maintaining, and publishing RDF vocabularies. Key aspects include:"}),"\n",(0,t.jsx)(n.h3,{id:"project-context-for-isbdm",children:"Project Context for ISBDM"}),"\n",(0,t.jsx)(n.p,{children:"For this specific project, the working group responsible for ISBDM started with the traditional process and created both the spreadsheet and HTML documentation independently. This HTML documentation (located in the ISBDM folder) serves as our prototype for designing the Docusaurus version. Since the content and design have already been approved by the working group, our conversion must be:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Visually Similar"}),": Maintain the same look and feel as the original"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Semantically Lossless"}),": Preserve all meaning and relationships"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Structurally Enhanced"}),": While changing the underlying implementation completely"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This situation presents unique requirements for the development process, as we must balance fidelity to the approved design with the implementation of our new RDF-focused workflow."}),"\n",(0,t.jsx)(n.h3,{id:"workflow-and-lifecycle",children:"Workflow and Lifecycle"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Initial Development"}),": Vocabularies begin as spreadsheets for drafting and review"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Formal Approval"}),": Working group reviews and approves vocabularies"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Documentation Creation"}),": Approved vocabularies are scaffolded into MDX with RDF in front matter"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Ongoing Maintenance"}),": Working group transitions to documentation development"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"RDF Publication"}),": CI/CD extracts and validates RDF from front matter into formal vocabularies"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Component-Driven Display"}),": Reusable React components render RDF data from front matter"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Templates"}),": Non-technical editors can create elements using templates with standardized front matter"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Global Defaults"}),": Reduce duplication and maintain consistency"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"CI/CD Pipeline"}),": GitHub Actions for RDF extraction, validation, and publication"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"versioning-strategy",children:"Versioning Strategy"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"RDF Versioning"}),": Semantic versioning with AI recommendations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Documentation Versioning"}),": Date-based, independent of RDF versioning"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Translation Versioning"}),": Language-specific metadata tracking translation status"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Release Management"}),": English primary, translations follow English releases"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"upcoming-development",children:"Upcoming Development"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"DCTAP Profiles"}),": Will control vocabulary structure, front matter, and validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validation Tools"}),": Ensure consistency across RDF elements"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Enhanced Publishing"}),": Automated release management"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#global-component-defaults",children:"Global Component Defaults"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#image-size-module-fix",children:"Image Size Module Fix"})}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"global-component-defaults",children:"Global Component Defaults"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Date: 2025-05-11"})}),"\n",(0,t.jsx)(n.h3,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["We implemented a system for providing global default values to components via Docusaurus's ",(0,t.jsx)(n.code,{children:"customFields"})," configuration. This reduces duplication in front matter across similar content types while maintaining the ability to override any value when needed."]}),"\n",(0,t.jsx)(n.h3,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Configuration in docusaurus.config.ts"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// docusaurus.config.ts\nconst config = {\n  // ... other config\n  customFields: {\n    vocabularyDefaults: {\n      prefix: "isbdm",\n      startCounter: 1000,\n      uriStyle: "numeric",\n      caseStyle: "kebab-case",\n      showFilter: true,\n      filterPlaceholder: "Filter vocabulary terms...",\n      showTitle: false,\n      RDF: {\n        "rdf:type": ["skos:ConceptScheme"]\n      }\n    }\n  }\n};\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Access in Components"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import useDocusaurusContext from '@docusaurus/useDocusaurusContext';\n\nexport function MyComponent(props) {\n  // Get site config for default values\n  const { siteConfig } = useDocusaurusContext();\n  const defaults = siteConfig.customFields?.vocabularyDefaults || {};\n  \n  // Merge props with defaults, prioritizing props\n  const resolvedPrefix = props.prefix || defaults.prefix || 'hardcoded-fallback';\n  \n  // Use resolved values in rendering\n  // ...\n}\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Handle Static Methods"}),":\nFor static methods that can't use React hooks, access defaults via ",(0,t.jsx)(n.code,{children:"window.__DOCUSAURUS__"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Static method\nMyComponent.staticMethod = (props) => {\n  let defaults = {};\n  \n  if (typeof window !== 'undefined' && \n      window.__DOCUSAURUS__ && \n      window.__DOCUSAURUS__.siteConfig &&\n      window.__DOCUSAURUS__.siteConfig.customFields) {\n    defaults = window.__DOCUSAURUS__.siteConfig.customFields.vocabularyDefaults || {};\n  }\n  \n  // Use defaults...\n};\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"TypeScript Support"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// TypeScript declaration for window.__DOCUSAURUS__\ndeclare global {\n  interface Window {\n    __DOCUSAURUS__?: {\n      siteConfig: {\n        customFields?: {\n          vocabularyDefaults?: {\n            prefix?: string;\n            // other properties...\n          };\n        };\n      };\n    };\n  }\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"testing-approach",children:"Testing Approach"}),"\n",(0,t.jsx)(n.p,{children:"We created comprehensive tests to verify the defaults system:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Test with Site Defaults"}),": Mock ",(0,t.jsx)(n.code,{children:"useDocusaurusContext"})," to return configured defaults"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Test with No Site Defaults"}),": Test fallback to hardcoded values"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Test Property Overriding"}),": Verify that props correctly override defaults"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Test Real-World Examples"}),": Test with actual content examples"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example test suite:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"/src/tests/components/VocabularyTableDefaults.test.tsx"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"/src/tests/components/VocabularyTableNoDefaults.test.tsx"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"/src/tests/components/VocabularyTableRealExamples.test.tsx"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"})," - Requiring all properties in front matter:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mdx",children:'---\nvocabularyId: "1275"\ntitle: "My Vocabulary"\nprefix: "isbdm"\nstartCounter: 1000\nuriStyle: "numeric"\ncaseStyle: "kebab-case"\nshowFilter: true\nfilterPlaceholder: "Filter vocabulary terms..."\nshowTitle: false\nRDF:\n  rdf:type: \n    - skos:ConceptScheme\n  values:\n    - value: term1\n      definition: Definition of term\n---\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"})," - Using defaults:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mdx",children:'---\nvocabularyId: "1275" \ntitle: "My Vocabulary"\nRDF:\n  values:\n    - value: term1\n      definition: Definition of term\n---\n'})}),"\n",(0,t.jsx)(n.h3,{id:"documentation",children:"Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"COMPONENT-DEFAULTS.md"}),": Detailed explanation of the pattern"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs/examples/VocabularyTable.mdx"}),": Updated component documentation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs/examples/MinimalVocabulary.mdx"}),": Example using defaults"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"image-size-module-fix",children:"Image Size Module Fix"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Date: 2025-05-11"})}),"\n",(0,t.jsx)(n.h3,{id:"problem",children:"Problem"}),"\n",(0,t.jsxs)(n.p,{children:["We encountered an issue with the ",(0,t.jsx)(n.code,{children:"image-size"})," module when using Yarn Berry in PnP mode:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'TypeError [ERR_INVALID_ARG_TYPE]: The "buffer" argument must be an instance of Buffer, TypedArray, or DataView. Received an instance of ArrayBuffer\n'})}),"\n",(0,t.jsx)(n.h3,{id:"solution",children:"Solution"}),"\n",(0,t.jsx)(n.p,{children:"The simplest solution was to switch from Yarn Berry's PnP mode to the traditional node_modules resolution strategy:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Create ",(0,t.jsx)(n.code,{children:".yarnrc.yml"})," in the project root:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"nodeLinker: node-modules\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Reinstall dependencies:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yarn\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Update ",(0,t.jsx)(n.code,{children:"package.json"})," scripts to use standard Docusaurus commands:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"scripts": {\n  "start": "docusaurus start",\n  "build": "docusaurus build",\n  "start:patched": "node start-patched.js",\n  "build:patched": "node build-patched.js"\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"root-cause-analysis",children:"Root Cause Analysis"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Yarn Berry's PnP mode uses a custom module resolution system that affects Node.js internals"}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"image-size"})," module uses Node.js filesystem operations with binary data (Buffers/ArrayBuffers)"]}),"\n",(0,t.jsx)(n.li,{children:"In PnP mode, there's a compatibility issue between ArrayBuffer and Buffer conversions"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"alternative-approaches-not-used",children:"Alternative Approaches (Not Used)"}),"\n",(0,t.jsx)(n.p,{children:"We attempted several patches before finding the simpler solution:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"buffer-patch.js"}),": Enhanced Buffer.from to handle ArrayBuffers"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"filehandle-patch.js"}),": Patched FileHandle.read for ArrayBuffer conversion"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"image-size-direct-patch.js"}),": Direct interception of the image-size module"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"documentation-1",children:"Documentation"}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.code,{children:"IMAGE-SIZE-FIX.md"})," for detailed explanation."]}),"\n",(0,t.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},65404:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var i=s(36672);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);